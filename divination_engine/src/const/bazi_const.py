"""
四柱推命専用定数定義 (Bazi Constants)

このモジュールは四柱推命の計算に必要な全ての定数を定義します。
- 干支、五行、陰陽の定義
- 通変星（十神）の定義
- 十二運星の定義
- 蔵干表（阿部泰山流を採用）
- 蔵干の深浅割合テーブル
- 神殺（特殊星）の判定条件
- 刑冲会合の定義
"""
from typing import Dict, List, Tuple

# ============================================
# 基本定義
# ============================================

# 十干（天干）
STEMS = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"]

# 十二支（地支）
BRANCHES = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"]

# 六十干支
SIXTY_GANZHI = [
    f"{STEMS[i % 10]}{BRANCHES[i % 12]}" 
    for i in range(60)
]

# 天干の五行と陰陽
STEM_WUXING = {
    "甲": ("木", "陽"),
    "乙": ("木", "陰"),
    "丙": ("火", "陽"),
    "丁": ("火", "陰"),
    "戊": ("土", "陽"),
    "己": ("土", "陰"),
    "庚": ("金", "陽"),
    "辛": ("金", "陰"),
    "壬": ("水", "陽"),
    "癸": ("水", "陰"),
}

# 地支の五行と陰陽
BRANCH_WUXING = {
    "子": ("水", "陽"),
    "丑": ("土", "陰"),
    "寅": ("木", "陽"),
    "卯": ("木", "陰"),
    "辰": ("土", "陽"),
    "巳": ("火", "陰"),
    "午": ("火", "陽"),
    "未": ("土", "陰"),
    "申": ("金", "陽"),
    "酉": ("金", "陰"),
    "戌": ("土", "陽"),
    "亥": ("水", "陰"),
}

# ============================================
# 通変星（十神）の定義
# ============================================

# (日干五行, 対象五行, 陰陽一致) → 通変星
TEN_GODS_TABLE = {
    # 同じ五行
    ("木", "木", True): "比肩",
    ("木", "木", False): "劫財",
    ("火", "火", True): "比肩",
    ("火", "火", False): "劫財",
    ("土", "土", True): "比肩",
    ("土", "土", False): "劫財",
    ("金", "金", True): "比肩",
    ("金", "金", False): "劫財",
    ("水", "水", True): "比肩",
    ("水", "水", False): "劫財",
    
    # 日干が生む（食神・傷官）
    ("木", "火", True): "食神",
    ("木", "火", False): "傷官",
    ("火", "土", True): "食神",
    ("火", "土", False): "傷官",
    ("土", "金", True): "食神",
    ("土", "金", False): "傷官",
    ("金", "水", True): "食神",
    ("金", "水", False): "傷官",
    ("水", "木", True): "食神",
    ("水", "木", False): "傷官",
    
    # 日干を生む（偏印・正印）
    ("木", "水", True): "偏印",
    ("木", "水", False): "正印",
    ("火", "木", True): "偏印",
    ("火", "木", False): "正印",
    ("土", "火", True): "偏印",
    ("土", "火", False): "正印",
    ("金", "土", True): "偏印",
    ("金", "土", False): "正印",
    ("水", "金", True): "偏印",
    ("水", "金", False): "正印",
    
    # 日干が剋する（偏財・正財）
    ("木", "土", True): "偏財",
    ("木", "土", False): "正財",
    ("火", "金", True): "偏財",
    ("火", "金", False): "正財",
    ("土", "水", True): "偏財",
    ("土", "水", False): "正財",
    ("金", "木", True): "偏財",
    ("金", "木", False): "正財",
    ("水", "火", True): "偏財",
    ("水", "火", False): "正財",
    
    # 日干を剋する（偏官・正官）
    ("木", "金", True): "偏官",
    ("木", "金", False): "正官",
    ("火", "水", True): "偏官",
    ("火", "水", False): "正官",
    ("土", "木", True): "偏官",
    ("土", "木", False): "正官",
    ("金", "火", True): "偏官",
    ("金", "火", False): "正官",
    ("水", "土", True): "偏官",
    ("水", "土", False): "正官",
}

# ============================================
# 十二運星の定義
# ============================================

TWELVE_PHASES = ["長生", "沐浴", "冠帯", "建禄", "帝旺", "衰", "病", "死", "墓", "絶", "胎", "養"]

# 各天干の長生位置
CHANGSHEN_POSITION = {
    "甲": "亥", "乙": "午",
    "丙": "寅", "丁": "酉",
    "戊": "寅", "己": "酉",  # 土は寄木・寄金
    "庚": "巳", "辛": "子",
    "壬": "申", "癸": "卯",
}

# ============================================
# 蔵干表（阿部泰山流を採用）
# ============================================

# 各地支に含まれる蔵干（余気・中気・本気の順）
# 阿部泰山流における蔵干表
ZOGAN_TABLE = {
    "子": {"余気": None, "中気": None, "本気": "癸"},
    "丑": {"余気": "癸", "中気": "辛", "本気": "己"},
    "寅": {"余気": "戊", "中気": "丙", "本気": "甲"},
    "卯": {"余気": None, "中気": None, "本気": "乙"},
    "辰": {"余気": "乙", "中気": "癸", "本気": "戊"},
    "巳": {"余気": "戊", "中気": "庚", "本気": "丙"},
    "午": {"余気": None, "中気": "己", "本気": "丁"},
    "未": {"余気": "丁", "中気": "乙", "本気": "己"},
    "申": {"余気": "戊", "中気": "壬", "本気": "庚"},
    "酉": {"余気": None, "中気": None, "本気": "辛"},
    "戌": {"余気": "辛", "中気": "丁", "本気": "戊"},
    "亥": {"余気": None, "中気": "甲", "本気": "壬"},
}

# ============================================
# 蔵干深浅の割合テーブル（阿部泰山流）
# ============================================

# 月支蔵干の深浅を時間按分で決定するための割合
# 節入りからの経過率 → 採用する蔵干
# 泰山流：余気 → 中気 → 本気の順で、各月の日数配分による
ZOGAN_DEPTH_RATIO = {
    "子": [("本気", 0.0, 1.0)],  # 子は癸のみ
    "丑": [("余気", 0.0, 0.30), ("中気", 0.30, 0.60), ("本気", 0.60, 1.0)],
    "寅": [("余気", 0.0, 0.23), ("中気", 0.23, 0.47), ("本気", 0.47, 1.0)],
    "卯": [("本気", 0.0, 1.0)],  # 卯は乙のみ
    "辰": [("余気", 0.0, 0.30), ("中気", 0.30, 0.60), ("本気", 0.60, 1.0)],
    "巳": [("余気", 0.0, 0.23), ("中気", 0.23, 0.47), ("本気", 0.47, 1.0)],
    "午": [("中気", 0.0, 0.33), ("本気", 0.33, 1.0)],  # 余気なし
    "未": [("余気", 0.0, 0.30), ("中気", 0.30, 0.60), ("本気", 0.60, 1.0)],
    "申": [("余気", 0.0, 0.23), ("中気", 0.23, 0.47), ("本気", 0.47, 1.0)],
    "酉": [("本気", 0.0, 1.0)],  # 酉は辛のみ
    "戌": [("余気", 0.0, 0.30), ("中気", 0.30, 0.60), ("本気", 0.60, 1.0)],
    "亥": [("中気", 0.0, 0.40), ("本気", 0.40, 1.0)],  # 余気なし
}

# ============================================
# 干合・支合・会局の定義
# ============================================

# 干合（天干の合）
KANGO_PAIRS = [
    ("甲", "己"),  # 甲己合土
    ("乙", "庚"),  # 乙庚合金
    ("丙", "辛"),  # 丙辛合水
    ("丁", "壬"),  # 丁壬合木
    ("戊", "癸"),  # 戊癸合火
]

# 干合の化気
KANGO_TRANSFORM = {
    ("甲", "己"): "土",
    ("乙", "庚"): "金",
    ("丙", "辛"): "水",
    ("丁", "壬"): "木",
    ("戊", "癸"): "火",
}

# 六合（支合）
ZHIHE_PAIRS = [
    ("子", "丑"),  # 土
    ("寅", "亥"),  # 木
    ("卯", "戌"),  # 火
    ("辰", "酉"),  # 金
    ("巳", "申"),  # 水
    ("午", "未"),  # 土
]

# 三合会局
SANGO_SETS = {
    "木局": ["寅", "午", "戌"],  # 火局の誤記を修正→正確には寅午戌は火局
    "火局": ["寅", "午", "戌"],
    "金局": ["巳", "酉", "丑"],
    "水局": ["申", "子", "辰"],
    "木局_correct": ["亥", "卯", "未"],
}

# 三合会局（正確な定義）
SANGO_CORRECT = {
    "水局": (["申", "子", "辰"], "水"),
    "木局": (["亥", "卯", "未"], "木"),
    "火局": (["寅", "午", "戌"], "火"),
    "金局": (["巳", "酉", "丑"], "金"),
}

# 半会（三合の2支）
HANGE_SETS = {
    "水局": [("申", "子"), ("子", "辰")],
    "木局": [("亥", "卯"), ("卯", "未")],
    "火局": [("寅", "午"), ("午", "戌")],
    "金局": [("巳", "酉"), ("酉", "丑")],
}

# 方三位（方合）
HOSANI_SETS = {
    "北方水": ["亥", "子", "丑"],
    "東方木": ["寅", "卯", "辰"],
    "南方火": ["巳", "午", "未"],
    "西方金": ["申", "酉", "戌"],
}

# ============================================
# 刑冲破害の定義
# ============================================

# 対冲（六冲）
CHU_PAIRS = [
    ("子", "午"),
    ("丑", "未"),
    ("寅", "申"),
    ("卯", "酉"),
    ("辰", "戌"),
    ("巳", "亥"),
]

# 三刑
SANKEI = {
    "無恩の刑": ["寅", "巳", "申"],  # 寅巳申
    "無礼の刑": ["丑", "戌", "未"],  # 丑戌未
    "持勢の刑": ["子", "卯"],        # 子卯
}

# 自刑
JIKEI = ["辰", "午", "酉", "亥"]

# 六害
GAIKEKI_PAIRS = [
    ("子", "未"),
    ("丑", "午"),
    ("寅", "巳"),
    ("卯", "辰"),
    ("申", "亥"),
    ("酉", "戌"),
]

# 六破
ROKUHA_PAIRS = [
    ("子", "酉"),
    ("丑", "辰"),
    ("寅", "亥"),
    ("卯", "午"),
    ("巳", "申"),
    ("未", "戌"),
]

# ============================================
# 空亡（天中殺）の定義
# ============================================

# 日柱の干支番号に基づく空亡
KUUBO_TABLE = {
    range(0, 10): ["戌", "亥"],    # 甲子旬（甲子〜癸酉）
    range(10, 20): ["申", "酉"],   # 甲戌旬
    range(20, 30): ["午", "未"],   # 甲申旬
    range(30, 40): ["辰", "巳"],   # 甲午旬
    range(40, 50): ["寅", "卯"],   # 甲辰旬
    range(50, 60): ["子", "丑"],   # 甲寅旬
}

# ============================================
# 神殺（特殊星）の定義
# ============================================

# 天乙貴人（昼生まれ基準、簡易版）
TENOTSU_KIJIN = {
    "甲": ["丑", "未"],
    "乙": ["子", "申"],
    "丙": ["亥", "酉"],
    "丁": ["亥", "酉"],
    "戊": ["丑", "未"],
    "己": ["子", "申"],
    "庚": ["丑", "未"],
    "辛": ["寅", "午"],
    "壬": ["卯", "巳"],
    "癸": ["卯", "巳"],
}

# 駅馬
EKIBA = {
    "寅": "申", "午": "申", "戌": "申",
    "申": "寅", "子": "寅", "辰": "寅",
    "巳": "亥", "酉": "亥", "丑": "亥",
    "亥": "巳", "卯": "巳", "未": "巳",
}

# 桃花（咸池）
TOUKA = {
    "寅": "卯", "午": "卯", "戌": "卯",
    "申": "酉", "子": "酉", "辰": "酉",
    "巳": "午", "酉": "午", "丑": "午",
    "亥": "子", "卯": "子", "未": "子",
}

# 華蓋
KAGAI = {
    "寅": "戌", "午": "戌", "戌": "戌",
    "申": "辰", "子": "辰", "辰": "辰",
    "巳": "丑", "酉": "丑", "丑": "丑",
    "亥": "未", "卯": "未", "未": "未",
}

# 羊刃（陽干のみ）
YOUJIN = {
    "甲": "卯",
    "丙": "午",
    "戊": "午",
    "庚": "酉",
    "壬": "子",
}

# 魁罡
KAIGOU = ["庚戌", "庚辰", "壬辰", "戊戌"]

# 紅艶
KOUEN = {
    "甲": "午", "乙": "午",
    "丙": "寅", "丁": "未",
    "戊": "辰", "己": "辰",
    "庚": "戌", "辛": "酉",
    "壬": "子", "癸": "申",
}

# 金與禄
KINYOROKU = {
    "甲": "寅", "乙": "卯",
    "丙": "巳", "丁": "午",
    "戊": "巳", "己": "午",
    "庚": "申", "辛": "酉",
    "壬": "亥", "癸": "子",
}

# ============================================
# 五行のエネルギー点数（レーダーチャート用）
# ============================================

# 天干のエネルギー値
STEM_ENERGY = 1.0

# 地支のエネルギー値（本気）
BRANCH_ENERGY = {
    "本気": 1.0,
    "中気": 0.5,
    "余気": 0.3,
}
