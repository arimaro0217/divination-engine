"""
九星気学専用定数定義 (Kyusei Kigaku Constants)

このモジュールは九星気学の計算に必要な全ての定数を定義します。
- 九星の定義（名称、五行、色、エネルギーなど）
- 方位の定義（8方位、24方位の角度範囲）
- 吉凶判定用テーブル
- 陽遁・隠遁の基準定義
"""
from typing import Dict, List, Tuple
from enum import Enum

# ============================================
# 九星の定義
# ============================================

class NineStar(Enum):
    """九星"""
    IPPAKU = 1      # 一白水星
    JIKOKU = 2      # 二黒土星
    SANPEKI = 3     # 三碧木星
    SHIROKU = 4     # 四緑木星
    GOO = 5         # 五黄土星
    ROPPAKU = 6     # 六白金星
    SHICHISEKI = 7  # 七赤金星
    HAPPAKU = 8     # 八白土星
    KYUSHI = 9      # 九紫火星

# 九星の名称
NINE_STAR_NAMES = {
    1: "一白水星",
    2: "二黒土星",
    3: "三碧木星",
    4: "四緑木星",
    5: "五黄土星",
    6: "六白金星",
    7: "七赤金星",
    8: "八白土星",
    9: "九紫火星"
}

# 九星の五行
NINE_STAR_ELEMENTS = {
    1: "水",
    2: "土",
    3: "木",
    4: "木",
    5: "土",
    6: "金",
    7: "金",
    8: "土",
    9: "火"
}

# 九星の色
NINE_STAR_COLORS = {
    1: "白",
    2: "黒",
    3: "碧（青緑）",
    4: "緑",
    5: "黄",
    6: "白",
    7: "赤",
    8: "白",
    9: "紫"
}

# 九星の陰陽
NINE_STAR_YINYANG = {
    1: "陽",
    2: "陰",
    3: "陽",
    4: "陰",
    5: "陽",  # 中央で陰陽どちらでもないが便宜上陽
    6: "陽",
    7: "陰",
    8: "陽",
    9: "陰"
}

# ============================================
# 方位の定義
# ============================================

class Direction(Enum):
    """8方位"""
    NORTH = "N"
    NORTHEAST = "NE"
    EAST = "E"
    SOUTHEAST = "SE"
    SOUTH = "S"
    SOUTHWEST = "SW"
    WEST = "W"
    NORTHWEST = "NW"

# 方位の日本語名
DIRECTION_NAMES_JP = {
    "N": "北",
    "NE": "北東",
    "E": "東",
    "SE": "南東",
    "S": "南",
    "SW": "南西",
    "W": "西",
    "NW": "北西"
}

# 標準方式（東西南北30度、四隅60度）
DIRECTION_ANGLES_STANDARD = {
    "N":  {"start": 345, "end": 15, "width": 30},
    "NE": {"start": 15,  "end": 75, "width": 60},
    "E":  {"start": 75,  "end": 105, "width": 30},
    "SE": {"start": 105, "end": 165, "width": 60},
    "S":  {"start": 165, "end": 195, "width": 30},
    "SW": {"start": 195, "end": 255, "width": 60},
    "W":  {"start": 255, "end": 285, "width": 30},
    "NW": {"start": 285, "end": 345, "width": 60}
}

# 等分方式（全方位45度）
DIRECTION_ANGLES_EQUAL = {
    "N":  {"start": 337.5, "end": 22.5, "width": 45},
    "NE": {"start": 22.5,  "end": 67.5, "width": 45},
    "E":  {"start": 67.5,  "end": 112.5, "width": 45},
    "SE": {"start": 112.5, "end": 157.5, "width": 45},
    "S":  {"start": 157.5, "end": 202.5, "width": 45},
    "SW": {"start": 202.5, "end": 247.5, "width": 45},
    "W":  {"start": 247.5, "end": 292.5, "width": 45},
    "NW": {"start": 292.5, "end": 337.5, "width": 45}
}

# 九宮図での方位配置（後天定位）
DIRECTION_TO_PALACE = {
    "N": 1,   # 坎宮
    "SW": 2,  # 坤宮
    "E": 3,   # 震宮
    "SE": 4,  # 巽宮
    # 5は中宮（方位なし）
    "NW": 6,  # 乾宮
    "W": 7,   # 兌宮
    "NE": 8,  # 艮宮
    "S": 9    # 離宮
}

# 宮から方位への逆引き
PALACE_TO_DIRECTION = {v: k for k, v in DIRECTION_TO_PALACE.items()}

# 宮の名称
PALACE_NAMES = {
    1: "坎宮（北）",
    2: "坤宮（南西）",
    3: "震宮（東）",
    4: "巽宮（南東）",
    5: "中宮（中央）",
    6: "乾宮（北西）",
    7: "兌宮（西）",
    8: "艮宮（北東）",
    9: "離宮（南）"
}

# ============================================
# 飛泊（九星の移動）の順序
# ============================================

# 中宮から各宮への飛泊順序（洛書の順序）
HIBAKU_ORDER = [5, 6, 7, 8, 9, 1, 2, 3, 4]

# 各宮からの次の移動先
HIBAKU_NEXT = {
    1: 2,
    2: 3,
    3: 4,
    4: 5,
    5: 6,
    6: 7,
    7: 8,
    8: 9,
    9: 1
}

# ============================================
# 陽遁・隠遁の定義
# ============================================

class TonType(Enum):
    """陽遁・隠遁のタイプ"""
    YOTON = "陽遁"  # 1→2→3...→9の昇順
    INTON = "隠遁"  # 9→8→7...→1の降順

# 陽遁の基準：冬至（太陽黄経270度）
YOTON_REFERENCE_LONGITUDE = 270.0

# 隠遁の基準：夏至（太陽黄経90度）
INTON_REFERENCE_LONGITUDE = 90.0

# ============================================
# 吉凶方位の定義
# ============================================

class DirectionStatus(Enum):
    """方位の吉凶ステータス"""
    BEST = "最大吉方"
    GOOD = "吉方"
    NEUTRAL = "平"
    BAD = "凶方"
    WORST = "大凶方"

# 五黄殺：五黄土星が回座する方位
# ※ 計算で動的に決定

# 暗剣殺：五黄土星の対中（180度反対）
# ※ 計算で動的に決定

# 対中方位のマッピング
OPPOSITE_DIRECTION = {
    "N": "S",
    "NE": "SW",
    "E": "W",
    "SE": "NW",
    "S": "N",
    "SW": "NE",
    "W": "E",
    "NW": "SE"
}

# ============================================
# 天道・天徳（月の吉方位）
# ============================================

# 天道方位（節気月による）
# 寅月（2月）から順に
TENDO_DIRECTIONS = {
    2: "NW",   # 寅月：乾（北西）
    3: "W",    # 卯月：兌（西）
    4: "NE",   # 辰月：艮（北東）
    5: "E",    # 巳月：震（東）
    6: "SE",   # 午月：巽（南東）
    7: "S",    # 未月：離（南）
    8: "SW",   # 申月：坤（南西）
    9: "W",    # 酉月：兌（西）
    10: "NW",  # 戌月：乾（北西）
    11: "N",   # 亥月：坎（北）
    12: "NE",  # 子月：艮（北東）
    1: "E"     # 丑月：震（東）
}

# 天徳方位（月の干支による）
# ※ より複雑な計算が必要だが、簡易版として月による定義
TENTOKU_BY_MONTH = {
    2: "巳",   # 寅月
    3: "申",   # 卯月
    4: "亥",   # 辰月
    5: "艮",   # 巳月
    6: "乾",   # 午月
    7: "甲",   # 未月
    8: "癸",   # 申月
    9: "寅",   # 酉月
    10: "乙",  # 戌月
    11: "巽",  # 亥月
    12: "丙",  # 子月
    1: "坤"    # 丑月
}

# ============================================
# 相生・相剋関係（五行）
# ============================================

# 相生（生み出す）関係
SHENG_CYCLE = {
    "木": "火",
    "火": "土",
    "土": "金",
    "金": "水",
    "水": "木"
}

# 相剋（剋す）関係
KE_CYCLE = {
    "木": "土",
    "土": "水",
    "水": "火",
    "火": "金",
    "金": "木"
}

# ============================================
# 月命星の起算表
# ============================================

# 年命星（本命星）によって月命星の起算が異なる
# 1,4,7の年：8から逆順
# 2,5,8の年：5から逆順
# 3,6,9の年：2から逆順
MONTH_STAR_BASE = {
    1: 8,
    2: 5,
    3: 2,
    4: 8,
    5: 5,
    6: 2,
    7: 8,
    8: 5,
    9: 2
}

# ============================================
# 日盤の基準日
# ============================================

# 上元甲子日（基準日）
# 1984年2月4日が甲子日で一白水星日とされる
REFERENCE_DATE_JD = 2445735.5  # Julian Day
REFERENCE_DATE_STAR = 1  # 一白水星

# ============================================
# 時盤の計算用テーブル
# ============================================

# 時盤は季節（夏至〜冬至、冬至〜夏至）と日干支で決まる
# ※ 複雑なため、実装時に詳細化

# ============================================
# 本命殺・本命的殺の相対位置
# ============================================

# 本命星から見た本命殺の位置（対中）
# 例：本命が一白（北）なら本命殺は南

# 本命星から見た本命的殺の位置
# 例：本命が一白（北）なら本命的殺は南西
# ※ これも計算で動的に決定

# ============================================
# 偏角計算用の定数
# ============================================

# 日本国内の偏角簡易計算用パラメータ
# 基準点：東京（北緯35度、東経140度）で約-7度（西偏）
MAGNETIC_DECLINATION_BASE = -7.0
MAGNETIC_BASE_LAT = 35.0
MAGNETIC_BASE_LON = 140.0
MAGNETIC_LAT_COEFFICIENT = 0.1
MAGNETIC_LON_COEFFICIENT = 0.05

# WMM（World Magnetic Model）2020の使用フラグ
# ※ 将来の拡張用
USE_WMM_MODEL = False
